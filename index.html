<!DOCTYPE HTML>

<html>
<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />

<link rel="shortcut icon" href="./favicon.ico" />

<link rel="stylesheet" type="text/css" href="./bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="./bootstrap-theme.css">
<link rel="stylesheet" type="text/css" href="./style.css">
<link rel="stylesheet" type="text/css" href="./prettify.css">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-80869037-1', 'auto');
  ga('send', 'pageview');

</script>

<script type="text/javascript" src="./jquery.js"></script>
<script type="text/javascript" src="./jquery-ui.min.js"></script>
<script type="text/javascript" src="./run_prettify.js"></script>
<script type="text/javascript" src="./Sequencr.dev.js"></script>

<script type="text/javascript">
	var headertext = "Chain functions together, or execute loops, punctuated by timeouts or promises.";
	var headerblink = true;
	setTimeout(function(){
		Sequencr.for(0, headertext.length, function(i){
			$("#headertext").append(headertext[i]);
		}, function(){return 10 + Math.pow(Math.random(), 2) * 130}, function(){
			$("#maindownloadbutton").fadeTo(500, 1);
			setTimeout(function(){
				headerblink = false;
			}, 5000)
		});
	}, 750);
	
	Sequencr.do(function(){
		if(headerblink){
			$("#headercursorchar").toggle();
		}
		else{
			$("#headercursorchar").hide();
		}
		return headerblink;
	}, 250);
	
	
	//JUMPING MARIO
	//You could accomplish this with sequencr as well, but realistically there's nothing wrong with the jquery method.
	
	var marioAlreadyJumpped = false;
	var navbarLoose = false;
	var originalMenuHeight = Infinity;
	$(function(){
		originalMenuHeight = $("#navdiv").offset().top;
		$(window).scroll(function(data){
			if(!marioAlreadyJumpped && $(window).scrollTop() + $(window).height() > $("#mario").offset().top + $("#mario").height()){
				marioAlreadyJumpped = true;
				$("#mario").attr("src", "./mariojumping.png");
				$("#mario").animate({"top": -($("#mariocontainer").height() - $("#mario").height())}, 300, "easeOutQuad", function(){
					$("#mario").animate({"top": 0}, 300, "easeInQuad", function(){
						$("#mario").attr("src", "./mario.png");
					});
				});
			}
			
			if($(window).scrollTop() > originalMenuHeight){
				if(!navbarLoose) $("#navdiv").css("position", "fixed");
				navbarLoose = true;
			}
			else{
				if(navbarLoose) $("#navdiv").css("position", "static");
				navbarLoose = false;
			}
		});
	});
	//MARIO EXAMPLE
	
	function marioBig(){
		$("#mario").css("height", "100px");
	}
	
	function marioSmall(){
		$("#mario").css("height", "70px");
	}
	
	$(function(){
		$("#mario").click(function(){
			if($(this).css("height") == "70px"){
				Sequencr.chain([
					marioBig, 
					marioSmall, 
					marioBig, 
					marioSmall, 
					marioBig, 
					function(){changingLock = false;}
				], 100);
			}
			else{
				Sequencr.chain([
					marioSmall, 
					marioBig, 
					marioSmall, 
					marioBig, 
					marioSmall, 
					function(){changingLock = false;}
				], 100);
			}
	});
	});
	
	//PRIME NUMBER EXAMPLE
	
	function recursivePrimeFinder(value) {
		Sequencr.for(0, ~~Math.sqrt(value / 1000), 
			function(i){
				for(var x = i * 1000 + 2; x < i + 1000 && x < value; x++){
					if(value % x === 0) {
						return false; //Breaks out of the loop
					}
				}
			}, 
			1, //Interval
			function(completed){ 
				//Done callback - completed will be true iff value is prime
				if(completed){
					$("#primenumbers").append("<li>" + value + "</li>");
					while($("#primenumbers").height() > $("#primenumberscodesample").height()){
						$("#primenumbers").find("li").first().remove();
					}
				}
				recursivePrimeFinder(value + 2);
			});
	}
	
	$(function(){recursivePrimeFinder(100000001);}); //Start all the way up here.
	
	//PRINT TEXT EXAMPLE 1
	
	sampleText = "The quick brown fox jumps over the lazy dog.";
	var printLock = false;
	var timeout = 75;
	$(function(){
		$("#txtEx1Btn").click(function(){
			if(printLock)
				return;
			printLock = true;
			$("#txt1out").html("");//Clear the output
		
			Sequencr.for(0, sampleText.length, function(i){
				$("#txt1out").append(sampleText[i]); //Append char
			}, timeout, //Timeout in ms
			function(){printLock = false}); //Done callback
		});
	});
	
	var printLock2 = false;
	var timeout = 75;
	$(function(){
		$("#txtEx2Btn").click(function(){
			if(printLock2)
				return;
			printLock2 = true;
			$("#txt2out").html("");//Clear the output
		
			Sequencr.for(0, sampleText.length, function(i){
				$("#txt2out").append(sampleText[i]); //Append char
			}, 
			function(i){ //i is the index within the loop
				var timeout = 50; //Min timeout.
				timeout += 200 * Math.random(); //Random factor
				if(sampleText[i] == sampleText[i].toUpperCase()){
					//Everyone knows uppercase letters take longer to type
					timeout += 25; 
				}
				switch(sampleText[i].toLowerCase()){
					case ".":
					case ",":
						timeout += 100 * Math.random(); //Punctuation penalty
						break;
					case "a":
					case "s":
					case "d":
					case "f":
					case "j":
					case "k":
					case "l":
					case ";":
						timeout += 10 * Math.random(); //Home row penalty
						break;
					case "q":
					case "z":
					case "p":
					case "/":
						timeout += 60 * Math.random(); //Pinky penalty
						break;
					default:
						timeout += 40 * Math.random(); //Other keys penalty
				}
				return timeout;
			}
			, 
			function(){printLock2 = false}); //Done callback
		});
	});
	
	
</script>
<body>
	<div style="position: fixed; right: 10px; bottom: 10px; color: #444; line-height: 20px;">&copy;2016 - Joshua Sideris</div>
	<div class="headbg">
		<div class="headcontent container">
			<img src="./Logo.png" /><span id="logoname">Sequencr.js v5</span>
		
			<br clear="all" /><br />
			<!--<div class="consoleboxbox"><div class="consolebox">-->
				<span id="headertext">&nbsp;</span><span id="headercursorchar">&brvbar;</span>
			<!--</div></div>-->
			<br /><br />
			<a id="maindownloadbutton" name="download" href="https://github.com/JSideris/Sequencr.js/releases" target="_blank" class="btn btn-xlg btn-success">Download Sequencr.js</a>
		</div>
	</div>
	<br /><br />
	<div id="mainbodybg"><!-- Main content -->
		<div class="container">
			<div id="navdiv">
				<a href="#download" class="tocnav">Download</a>
				<a href="#chaining" class="tocnav">Function Chaining</a>
				<a href="#nonblockingloops" class="tocnav">Non-Blocking Loops</a>
				<a href="#promises" class="tocnav">Promises</a>
				<a href="#moreinfo" class="tocnav">More Info</a>
			</div>
			<div class="tocnav" style="visibility: hidden;">&nbsp;</div>
			<h1>Features</h1>
			<a name="chaining"></a>
			<h2>Function Chaining</h2>
			<p>Sequencr.js was originally built to solve the annoying callback hell problem encountered when chaining computationally expensive blocking functions together.</p>
			<br />
			<table class="table"><tbody><tr>
				<td>
					<h3>This</h3>
					<pre class="prettyprint linenums">
setTimeout(function(timeout)
{
    function1();
    setTimeout(function(timeout)
    {
        function2();
        setTimeout(function(timeout)
        {
            function3();
        }, timeout, timeout)
    }, timeout, timeout)
}, 10, 10);
					</pre>
				</td>
				<td>
					<h3>becomes this.</h3>
					<pre class="prettyprint linenums">
Sequencr.chain([function1, function2, function3], 10);
					</pre>
				</td>
			</tr></tbody></table>
			<p>But this is also handy for adding visual effects to a page. Hint: click Mario to whack him with a boomerang or give him a red mushroom.</p>
			<br />
			<table class="table"><tbody><tr>
				<td class="col-md-8">
					<pre class="prettyprint linenums">
function marioBig(){
	$("#mario").css("height", "100px");
}

function marioSmall(){
	$("#mario").css("height", "70px");
}

$(function(){
	$("#mario").click(function(){
		if($(this).css("height") == "70px"){
			Sequencr.chain([
				marioBig, 
				marioSmall, 
				marioBig, 
				marioSmall, 
				marioBig, 
				function(){changingLock = false;}
			], 100);
		}
		else{
			Sequencr.chain([
				marioSmall, 
				marioBig, 
				marioSmall, 
				marioBig, 
				marioSmall, 
				function(){changingLock = false;}
			], 100);
		}
	});
});
					</pre>
				</td>
				<td id="mariocontainer" align="center" style="vertical-align:bottom;" class="col-md-4">
					<img id="mario" src="./mario.png" style="height: 100px; cursor: pointer; position:relative;" title="It's fair use, Nintendo." />
				</td>
			</tr></tbody></table>
			
			<p>I should mention that jquery is not a dependancy.</p>
			
			<p>Any value returned by a function will be used as an argument to the next function.</p>
			
			<a name="nonblockingloops"></a>
			<h2>Non-Blocking Loops</h2>
			<p>How do you avoid crashing the browser when running CPU-intensive loops? Since JavaScript doesn't have a native sleep() function, the answer is timeouts, of course. I got fed up with the limitations and annoyances of setInterval, clearInterval, and setTimeout, so I built a better solution: <code>Sequencr.for</code> and <code>Sequencr.do</code>.</p>
			<p>This can be useful for breaking up expensive loops. For instance, checking relatively high prime numbers without degrading user experience (yes it's been processing the entire time while you were up there playing with Mario):</p>
			<br />
			<table class="table"><tbody><tr>
				<td class="col-md-10">
					<pre id="primenumberscodesample" class="prettyprint linenums">
function recursivePrimeFinder(value) {
	Sequencr.for(0, ~~Math.sqrt(value / 1000), 
		function(i){
			for(var x = i * 1000 + 2; x < i + 1000 && x < value; x++){
				if(value % x === 0) {
					return false; //Breaks out of the loop
				}
			}
		}, 
		1, //Interval
		function(completed){ 
			//Done callback - completed will be true iff value is prime
			if(completed){
				$("#primenumbers").append("&lt;li&gt;" + value + "&lt;/li&gt;");
				while($("#primenumbers").height() > $("#primenumberscodesample").height()){
					$("#primenumbers").find("li").first().remove();
				}
			}
			recursivePrimeFinder(value + 2);
		});
}

$(function(){recursivePrimeFinder(100000001);}); //Start all the way up here.
					</pre>
				</td>
				<td class="col-md-2">
					<div class="consoleboxbox" style="height: 100%;"><div class="consolebox" style="height: 100%; color: #6F6;">
						<ul id="primenumbers" style="list-style-type: none;"></ul>
					</div></div>
				</td>
			</tr></tbody></table>
			
			<div style="margin-left: 50px; background-color: #FFD; padding: 10px;">
				<p>Note that the above example also demonstrates one method of pulling off an asynchronous nested loop, i.e., consider this typical blocking prime finder who's algorithm was used to build the above: </p>
					<pre class="prettyprint linenums">
for(var i = 2; i < 1000; i++){ //Test integers from 1 -> 1000
	prime = true; 
	for(j = 2; j < ~~Math.sqrt(i); j++)){ //Check factors
		if(i % j === 0) {
			prime = false; 
			break;
		}
	}
	if(prime)
		console.log(i);
}
				</pre>
					<p>Nesting is a bit tricky when the inner loop is required to be asynchronous. Recursion (or flattening the loop) works, <br/><a href="#promises">or use Sequencr.js' built-in promise-based techniques</a> (keep reading).</p>
			</div>
			<br />
			<p>Sequencr.js' callback-based loops also provide a succinct solution to numerous other common tasks.</p>
			<br />
			<table class="table"><tbody><tr>
				<td class="col-md-7">
					<pre class="prettyprint linenums">
sampleText = "The quick brown fox jumps over the lazy dog.";
var printLock = false;
var timeout = 75;
$(function(){
	$("#txtExBtn").click(function(){
		if(printLock)
			return;
		printLock = true;
		$("#txtout").html("");//Clear the output
	
		Sequencr.for(0, sampleText.length, function(i){
			$("#txtout").append(sampleText[i]); //Append char
		}, timeout, //Timeout in ms
		function(){printLock = false}); //Done callback
	});
});
					</pre>
				</td>
				<td class="col-md-5">
					<button class="button btn-lg" id="txtEx1Btn" >Click Me</button>
					<br /><br />
					<p id="txt1out" style="font-size: 20px; font-weight: bold;"></p>
				</td>
			</tr></tbody></table>
			Let's improve the above code - we'll make it more realistic, as if a human were actually typing it. Here's something setInterval can't do: variable timeouts. Just set timeout to a function that returns an integer.
			<br />
			<table class="table"><tbody><tr>
				<td class="col-md-7">
					<pre class="prettyprint linenums:18">
timeout = function(i){ //i is the index within the loop
	var timeout = 50; //Min timeout.
	timeout += 200 * Math.random(); //Random factor
	if(sampleText[i] == sampleText[i].toUpperCase()){
		//Everyone knows uppercase letters take longer to type
		timeout += 25; 
	}
	switch(sampleText[i].toLowerCase()){
		case ".":
		case ",":
			timeout += 100 * Math.random(); //Punctuation penalty
			break;
		case "a":
		case "s":
		case "d":
		case "f":
		case "j":
		case "k":
		case "l":
		case ";":
			timeout += 10 * Math.random(); //Home row penalty
			break;
		case "q":
		case "z":
		case "p":
		case "/":
			timeout += 60 * Math.random(); //Pinky penalty
			break;
		default:
			timeout += 40 * Math.random(); //Other keys penalty
	}
	return timeout;
}
					</pre>
				</td>
				<td class="col-md-5">
					<button class="button btn-lg" id="txtEx2Btn" >Click Me</button>
					<br /><br />
					<p id="txt2out" style="font-size: 20px; font-weight: bold;"></p>
				</td>
			</tr></tbody></table>
			
			<a name="promises"></a>
			<h2>Promises</h2>
			<p>Dealing with code that must make asynchronous requests? You need promises. Sequencr.js has you covered.</p>
			
			<p>We've got <code>Sequencr.promiseChain</code>, and <code>Sequencr.promiseFor</code> for your enjoyment. Let's take another look at that prime number example from above because if it were written using <code>Sequencr.promiseFor</code>, we wouldn't need any flattening or using recursion which is what promises are for!
			
			<pre class="prettyprint linenums">
Sequencr.promiseFor(2, 1000, function(i){
	if(i > 3){
		var myPromise = Sequencr.promiseFor(2, Math.max(~~Math.sqrt(i), 3), function(j){
			return new Promise(function(resolve, reject){
				setTimeout(function(){
					if(i % j === 0) {
						prime = false; 
						reject(i); //Break out of internal loop.
					}
					else{
						resolve(i);
					}
				}, 0);
			});
		});
		
		return new Promise(function(resolve){
			myPromise.then(function(x){
				console.log(x + " is prime.");
				resolve();
			}).catch(function(x){
				//console.log(x + " is not prime.");
				resolve();
			});	
		});
	}
	else{
		console.log(i + " is prime.");
	}
});
			</pre>
			
			<p><code>Sequencr.promiseChain</code> is also very useful for chaining together functions that make asynchronous requests. For instance:</p>
			<pre class="prettyprint linenums">
var myPromise = Sequencr.promiseChain([
function(){
    return new Promise(function(resolve, reject){
        resolve(100); //Arbitrary value.
    });
}, 
function(x){
    return new Promise(function(resolve, reject){
        resolve(x * 2); //Arbitrary value.
    });
}, 
function(x){
    return new Promise(function(resolve, reject){
        resolve(x + 10); //Arbitrary value.
    });
}, 
]);

//Whenever/later:
myPromise.then(function(x){
    console.log(x); //Will print 210, given the above sequence.
});
			</pre>
			
			<p>Don't forget to <a href="#moreinfo">check the wiki</a> (or just click the link right below this sentence) for more information on Sequencr.js' promises.</p>
			
			<a name="moreinfo"></a>
			<h1>Manual + More Info</h1>
			Check out the <a target="_blank" href="https://github.com/JSideris/Sequencr.js/wiki">Sequencr.js wiki</a> on github for more infromation, including the Sequencr.js manual, licensing, and how to contribute.
		</div>
	</div>
</body>
</html>